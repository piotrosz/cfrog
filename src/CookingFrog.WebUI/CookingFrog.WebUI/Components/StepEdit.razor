@using CookingFrog.WebUI.Components.Models

@if (_isEdit)
{
    <div class="mb-3">
    <InputTextArea
        class="form-control"
        id="txtSteps"
        rows="3"
        @bind-Value="_editedStep"/>
    </div>
    <div class="mb-3">
        <button
            type="button"
            class="btn btn-sm"
            @onclick="@(async () =>
                      {
                          await UpdateClicked.InvokeAsync(new StepUpdateModel(_editedStep, Index));
                          _isEdit = false;
                      })"
            title="zapisz">
            ✅
        </button>
        <button
            type="button"
            class="btn btn-sm"
            @onclick="@(async () =>
                      {
                          await DeleteClicked.InvokeAsync(Index);
                          _isEdit = false;
                      })"
            title="usuń">
            🗑️
        </button>
        <button
            type="button"
            class="btn btn-sm"
            @onclick="@(() => { _isEdit = false; })"
            title="anuluj">
            ❌
        </button>
    </div>
}
else
{
    <div class="input-group mb-3">
        
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="step@(Index)">
            <label class="form-check-label" for="step@(Index)">
                @if (Description.StartsWith("[stage]", StringComparison.OrdinalIgnoreCase))
                {
                    <p class="h5">@Description.Substring(7) 
                        <button type="button"
                                class="btn btn-sm"
                                @onclick="Edit">🖊️
                        </button>
                    </p>
                }
                else
                {
                    <b>@Index)</b>
                    <span>@((MarkupString)Description)</span>
                    <button type="button"
                            class="btn btn-sm"
                            @onclick="Edit">🖊️
                    </button>
                }

                
            </label>

        </div>
    </div>
    
}


@code {
    [Parameter]
    public int Index { get; set; }

    [Parameter] 
    public string Description { get; set; } = string.Empty;

    [Parameter] 
    public EventCallback<StepUpdateModel> UpdateClicked { get; set; }
    
    [Parameter]
    public EventCallback<int> DeleteClicked { get; set; }
    
    private bool _isEdit;

    private string _editedStep = string.Empty;

    protected override void OnInitialized()
    {
        _editedStep = Description;
    }

    private void Edit()
    {
        _isEdit = true;
    }
}